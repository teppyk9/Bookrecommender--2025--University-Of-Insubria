CREATE TABLE LIBRI(
    ID serial PRIMARY KEY,
    TITOLO text NOT NULL,
    AUTORE text NOT NULL,
    DESCRIZIONE text,
    CATEGORIA text,
    EDITORE text,
    PREZZO decimal (3,1),
    ANNOPUBBLICAZIONE smallint,
    MESEPUBBLICAZIONE smallint
);

CREATE TABLE UTENTI (
    ID SERIAL PRIMARY KEY,
    USERNAME TEXT UNIQUE NOT NULL,
    NOME TEXT NOT NULL,
    COGNOME TEXT NOT NULL,
    CODICE_FISCALE TEXT UNIQUE NOT NULL,
    EMAIL text UNIQUE NOT NULL,
    PASSWORD TEXT NOT NULL
);


CREATE TABLE VALUTAZIONI(
    IDLIBRO int REFERENCES LIBRI(ID),
    USERNAME text REFERENCES UTENTI(USERNAME),
    C_STILE text,
    V_STILE SMALLINT NOT NULL CHECK (V_STILE BETWEEN 1 AND 5),
    C_CONTENUTO text,
    V_CONTENUTO SMALLINT NOT NULL CHECK (V_STILE BETWEEN 1 AND 5),
    C_GRADEVOLEZZA text,
    V_GRADEVOLEZZA SMALLINT NOT NULL CHECK (V_STILE BETWEEN 1 AND 5),
    C_ORIGINALITA text,
    V_ORIGINALITA SMALLINT NOT NULL CHECK (V_STILE BETWEEN 1 AND 5),
    C_EDIZIONE text,
    V_EDIZIONE SMALLINT NOT NULL CHECK (V_STILE BETWEEN 1 AND 5),
    C_FINALE text,
    V_FINALE numeric GENERATED ALWAYS AS ((V_STILE + V_CONTENUTO + V_GRADEVOLEZZA + V_ORIGINALITA + V_EDIZIONE) / 5) STORED
);

CREATE TABLE CONSIGLI(
    IDLIBRO int REFERENCES LIBRI(ID) NOT NULL,
    USERNAME text REFERENCES UTENTI(USERNAME) NOT NULL,
    LIB_1 int REFERENCES LIBRI(ID),
    LIB_2 int REFERENCES LIBRI(ID),
    LIB_3 int REFERENCES LIBRI(ID)
);

CREATE TABLE LIBRERIE (
    ID SERIAL PRIMARY KEY,
    USERNAME text REFERENCES UTENTI(USERNAME),
    TITOLO_LIBRERIA text NOT NULL
);


CREATE TABLE LIBRERIA_LIBRO (
    IDLIBRERIA INT REFERENCES LIBRERIE(ID) ON DELETE CASCADE,
    IDLIBRO INT REFERENCES LIBRI(ID),
    PRIMARY KEY (IDLIBRERIA, IDLIBRO)
);